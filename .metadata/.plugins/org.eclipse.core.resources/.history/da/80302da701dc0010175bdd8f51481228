#ifndef MPU6050_H_
#define MPU6050_H_

#include "main.h" // Để dùng I2C_HandleTypeDef
#include <stdint.h>

#define SENSOR_ADDR (0x68 << 1)

/* Registers */
#define PWR_MGMT_1_REG  0x6B
#define SMPLRT_DIV_REG  0x19
#define GYRO_CONFIG_REG 0x1B
#define ACCEL_CONFIG_REG 0x1C

/* Registers Data */
#define ACCEL_XOUT_H    0x3B
#define GYRO_XOUT_H     0x43

/* Sensitivity (Dựa trên Config) */
#define ACCEL_SENSITIVITY 8192.0f  // Range +/- 4g
#define GYRO_SENSITIVITY  65.5f    // Range +/- 500 deg/s

/* Struct dữ liệu */
typedef struct {
    int16_t Ax_Raw, Ay_Raw, Az_Raw;
    int16_t Gx_Raw, Gy_Raw, Gz_Raw;

    float Ax, Ay, Az;       // Gia tốc (g)
    float Gx, Gy, Gz;       // Tốc độ góc (deg/s)

    float Pitch_Accel;      // Góc tính từ Accel
    float Pitch_Filtered;   // Góc sau khi lọc (Dùng để cân bằng)

    // Offset (Calib)
    float Pitch_Offset;
} MPU6050_t;

/* Functions */
uint8_t MPU6050_Init(I2C_HandleTypeDef *hi2c);
void MPU6050_Read_All(I2C_HandleTypeDef *hi2c, MPU6050_t *DataStruct);

#endif /* MPU6050_H_ */
